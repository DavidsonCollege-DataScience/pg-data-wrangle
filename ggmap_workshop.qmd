---
title: "Mapping Using ggplot"
format: html
execute:
  cache: true
---

## Intro

The `ggmap` package is a mapping library for R that is based on ggplot2. It allows data scientists to retrieve maps from a variety of sources like OSM, Google Maps, etc.

![](https://raw.githubusercontent.com/dkahle/ggmap/refs/heads/master/tools/README-ggmap-patchwork-1.png){.preview-image fig-alt="ggmap package example"}


## Installation

First, let's install some packages:

```{r}
#| eval:false

if (!require(tidyverse)) {
  install.package("tidyverse")
}

if (!require(maps)) {
  install.package("maps")
}

if (!require(educationdata)) {
  install.packages("educationdata")
}
```

These are the packages that we need. If you don't have them, the code will install them for you.

If you already have the packages, you can simply run:

```{r setup}
library(tidyverse)
library(educationdata)
library(maps)
```

## Sample Dataset

I will assume that you have merged the datasets and have access to the school metadata.

```{r}
## CCD Data
ccd <- get_education_data(
  level   = "schools",
  source  = "ccd",
  topic   = "directory",
  filters = list(year = 2020)
)

ccd <- ccd %>%
  filter(state_location == "NC")

```

Before we start, let's look at the data a little bit. As we can see, we have so much information, and there are two columns that can pinpoint the location of each school.

Let's focus on North Carolina data only:

```{r}
ccd <- ccd %>%
  filter(state_location == "NC")
```

## Mapping

Before we start, we need to fetch the information we need

```{r}
us_states <- map_data("state")
head(us_states)
```

This is not the most useful thing, but we will plot all the states:

```{r}
us_states %>%
  ggplot() +
  geom_polygon(aes(x = long, y = lat, group = group, fill = region)) +
  theme(legend.position = "none")
```

Now, we can look at just one state:

```{r}
us_states %>%
  filter(region == "north carolina") %>%
  ggplot() +
  geom_polygon(aes(x = long, y = lat, group = group, fill = region)) +
  theme(legend.position = "none") +
  labs(title = "North Carolina")
```

## Adding Information to Data

Well, we have all seen the map. But, what if we want to plot where all the schools are? We can. Add we need to do is to add a layer with `geom_point` to include all schools:

```{r}
us_states %>%
  dplyr::filter(region == "north carolina") %>%
  ggplot() +
  geom_polygon(aes(x = long, y = lat,
                   group = group, fill = region)) + 
  geom_point(data = ccd, aes(x = longitude, y = latitude)) +
  theme(legend.position = "none")
```

You can also color the dots. For example, whether

```{r}
us_states %>%
  dplyr::filter(region == "north carolina") %>%
  ggplot() +
  geom_polygon(aes(x = long, y = lat,
                   group = group, fill = region)) + 
  geom_point(data = ccd, aes(x = longitude, y = latitude, color = as.character(charter)))
```

When you analyze your dataset, you will be more specific and maybe look at the outreach efforts of each college.
